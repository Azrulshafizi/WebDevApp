{% extends "base.html" %}
{% block content %}

<script>

    let carts = document.querySelectorAll(".add-cart");


for (let i=0; i < carts.length; i++){
  carts[i].addEventListener('click', () => {
    console.log("add to cart");
    let cartItems = localStorage.getItem('productsInCart');
    alert("Item has been added!")
    cartNumbers(products[i]);
    totalCost(products[i]);
  })
}
let carts1 = document.querySelectorAll(".add-cart1");


for (let i=0; i < carts1.length; i++){
  carts1[i].addEventListener('click', () => {
    console.log("add to cart");
    alert("Item has been added!")
    cartNumbers(products1[i]);
    totalCost(products1[i]);
  })
}

function onLoadCartNumbers(){
  let productNumbers = localStorage.getItem('cartNumbers');
  let cartCost = localStorage.getItem('totalCost');

  if (cartCost < 0 || productNumbers < 0){
    localStorage.setItem('totalCost', 0);
    cartCost == 0;
    localStorage.setItem('cartNumbers', 0)
    productNumbers == 0;
  }
  else if (productNumbers){
    document.querySelector('.cart span').textContent = productNumbers;
  }


}


function cartNumbers(product) {

  let productNumbers = localStorage.getItem('cartNumbers');
  console.log("productNumbers");
  productNumbers = parseInt(productNumbers);

  if( productNumbers ){
    localStorage.setItem('cartNumbers', productNumbers + 1);
    document.querySelector('.cart span').textContent = productNumbers + 1;
  } else{
    localStorage.setItem('cartNumbers', 1);
    document.querySelector('.cart span').textContent = 1;
  }

  setItems(product);
}

function setItems(product) {
  let cartItems = localStorage.getItem('productsInCart');
  cartItems = JSON.parse(cartItems);
  console.log('My cartItems are', cartItems);

  if (cartItems != null) {

    if(cartItems[product.tag] == undefined){
      cartItems = {
        ...cartItems,
        [product.tag]: product
      }
    }
    cartItems[product.tag].inCart += 1;
  } else{
    product.inCart = 1;

    cartItems = {
      [product.tag]: product
    }
  }



  localStorage.setItem('productsInCart', JSON.stringify(cartItems));
}

function totalCost(product){
  // console.log("The product price is", product.price);
  let cartCost = localStorage.getItem('totalCost');

  console.log('My cart cost is', cartCost);
  console.log('type cartCost');

  if(cartCost != null){
    cartCost = parseInt(cartCost);
    localStorage.setItem("totalCost", cartCost + product.price);
  }else{
    localStorage.setItem("totalCost", product.price);

  }
}

function displayCart(){
  let cartItems = localStorage.getItem("productsInCart");
  let cartCost = localStorage.getItem('totalCost');
  let productNumbers = localStorage.getItem('cartNumbers');
  cartItems = JSON.parse(cartItems);
  let productContainer = document.querySelector("#shop");
  let productContainers = document.querySelector(".project");

  console.log(cartItems);
  if(cartItems && productContainer ){
    productContainer.innerHTML = '';
    Object.values(cartItems).map(item => {
      productContainer.innerHTML += `
      <section class="box">
      <img src="Image/${item.tag}.jpg">
      <div class="content">
        <h3><span>${item.name}</span></h3>
        <h4>Price: <span class="cart-price" id="cart-price">$${item.inCart * item.price}.00</span></h4>


        <p class="unit">Quantity: ${item.inCart}</p>
        <p class="btn-area" ><i aria-hidden="true" class="fa fa-trash"></i> <span onclick="Delete(this)"class="btn2">Remove</span></p>

      </div>
      </section>
      `
    });

    productContainers.innerHTML += `
    <aside class="right-bar">
      <h1>Cart Subtotal</h1>

      <hr>
      <p><span>Subtotal</span> <span class="cart-total-price">$${cartCost}.00</span></p>
      <hr>
      <p><span>Total</span> <span>$${cartCost}.00</span></p><a href="payment.html"><i class="fa fa-shopping-cart"></i>Payment</a>
    </aside>
    `

  }

}
function Delete(e){
  let products = [];
  let cartItems = localStorage.getItem("productsInCart");
  let cartCost = localStorage.getItem('totalCost');
  cartCost = parseInt(cartCost);
  let productNumbers = localStorage.getItem('cartNumbers');
  cartItems = JSON.parse(cartItems);

  Object.values(cartItems).map(item =>{
    if (item.name != e.parentElement.parentElement.children[0].textContent){
      products.push(item);
    }
    else if (item.name == e.parentElement.parentElement.children[0].textContent){
      cartCost = parseInt(cartCost);
      localStorage.setItem("totalCost", cartCost - item.inCart * item.price);
      localStorage.setItem("cartNumbers", productNumbers - item.inCart);
      document.querySelector('.cart span').textContent = productNumbers - item.inCart;
    }
  });
  localStorage.setItem('productsInCart', JSON.stringify(products))
  window.location.reload();
}


onLoadCartNumbers();
displayCart();

</script>


<script>
    let products = [
  {
    name: 'Family Package',
    tag: 'hand',
    price: 500,
    inCart: 0
  },
  {
    name: 'WEDDING/HONEYMOON PACKAGE',
    tag: 'Wedding',
    price: 1000,
    inCart: 0
  },
  {
    name: 'TOUR PACKAGE',
    tag: 'Offer2',
    price: 250,
    inCart: 0
  },
  {
    name: 'CORPORATE PACKAGE',
    tag: 'Offer3',
    price: 1200,
    inCart: 0
  }

]
let products1 = [
  {
    name: '1-Bedroom Villa(190m²)',
    tag: 'proom1',
    price: 250,
    inCart: 0
  },
  {
    name: '1-Bedroom Villa(230m²)',
    tag: 'proom22',
    price: 300,
    inCart: 0
  },
  {
    name: '1-Bedroom Villa(250m²)',
    tag: 'proom3',
    price: 350,
    inCart: 0
  },
  {
    name: '2-Bedroom Villa(457m²)',
    tag: 'proom44',
    price: 500,
    inCart: 0

  },
  {
    name: '3-Bedroom Villa(500m²)',
    tag: 'proom55',
    price: 600,
    inCart: 0
  },
  {
    name: '3-Bedroom Villa(590m²)',
    tag: 'proom66',
    price: 800,
    inCart: 0
  },
  {
    name: '4-Bedroom Villa(707m²)',
    tag: 'proom77',
    price: 1000,
    inCart: 0
  },
  {
    name: '4-Bedroom Villa(807m²)',
    tag: 'proom88',
    price: 1250,
    inCart: 0
  },
  {
    name: 'X Villa(907m²)',
    tag: 'proom99',
    price: 1500,
    inCart: 0
  },

]
</script>


{% endblock %}